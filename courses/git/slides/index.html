<!doctype html><html lang=en><head><meta charset=utf-8><title>Maxence Lagalle</title><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel=stylesheet href=/reveal-js/dist/reset.css><link rel=stylesheet href=/reveal-js/dist/reveal.css><link rel=stylesheet href=/reveal-js/dist/theme/moon.css id=theme><link rel=stylesheet href=/highlight-js/default.min.css></head><body><div class=reveal><div class=slides><section><h1 id=git--gitlab>Git & GitLab</h1><p>Maxence Lagalle</p><p>Avril 2023</p><p><a rel=license href=http://creativecommons.org/licenses/by-sa/4.0/><img alt="Licence Creative Commons" style=border-width:0 src=https://i.creativecommons.org/l/by-sa/4.0/88x31.png></a><br>Cette formation est mise à disposition selon les termes de la <a rel=license href=http://creativecommons.org/licenses/by-sa/4.0/>Licence Creative Commons Attribution - Partage dans les Mêmes Conditions 4.0 International</a>.</p></section><section><section data-shortcode-section><h1 id=introduction>Introduction</h1><p>Pourquoi utiliser un système de gestion de versions ?</p></section><section><h2 id=système-de-gestion-de-versions->Système de gestion de versions ?</h2><ul><li><p>Un <strong>système de gestion de versions (VCS)</strong> est un outil permettant de suivre les
modifications apportées au code source d&rsquo;un projet au fil du temps.</p></li><li><p>Son utilisation permet de :</p><ul><li>travailler ensemble sur un même code source</li><li>conserver l&rsquo;historique des modifications apportées</li><li>revenir à des versions précédentes</li><li>résoudre les conflits entre les modifications apportées par différents développeurs</li></ul></li></ul></section><section><h2 id=quels-sont-les-avantages->Quels sont les avantages ?</h2><h3 id=sécurité>Sécurité</h3><ul><li><strong>Sauvegarde automatique</strong> : les développeurs n&rsquo;ont pas besoin de se rappeler de faire des sauvegardes régulières de leur code, car le VCS s&rsquo;en charge automatiquement.</li><li><strong>Facilité de récupération</strong> : si un développeur supprime accidentellement un fichier important ou introduit une erreur dans le code, il peut facilement revenir à une version précédente du code grâce à l&rsquo;historique des modifications stocké dans le VCS.</li></ul></section><section><h3 id=travail-en-équipe>Travail en équipe</h3><ul><li><strong>Collaboration efficace</strong> : chaque développeur peut travailler sur sa propre branche de code et fusionner ses modifications avec la branche principale une fois qu&rsquo;il est satisfait de son travail.</li><li><strong>Gestion des conflits</strong> : si deux développeurs ont modifié le même fichier de code, le VCS les alertera et les aidera à résoudre le conflit en fusionnant les modifications de manière appropriée.</li></ul></section><section><h3 id=documentation>Documentation</h3><ul><li><strong>Historique des modifications</strong> : les développeurs peuvent facilement accéder à des versions antérieures du code et voir qui a effectué quelles modifications, quand et pourquoi.</li><li><strong>Commentaires</strong> : lorsqu&rsquo;un développeur effectue des modifications avec un VCS, il peut ajouter un message pour décrire les modifications apportées au code.</li></ul></section><section><h2 id=git->Git ?</h2><ul><li><a href=https://git-scm.com/ target=_blank rel=noopener>Git</a> a été créé par Linus Torvalds, le créateur du système d&rsquo;exploitation Linux, en 2005.</li><li>Il a été conçu pour être un VCS décentralisé, capable de gérer efficacement les grands projets open source tels que le développement du noyau Linux.</li><li>Git a rapidement gagné en popularité auprès de la communauté du développement de logiciels en raison de sa rapidité, de sa facilité d&rsquo;utilisation et de sa flexibilité.</li></ul></section><section><h3 id=système-décentralisé->Système décentralisé ?</h3><ul><li>Git, en tant que VCS décentralisé (ou distribué), permet à chaque développeur de disposer d&rsquo;une copie complète de l&rsquo;historique des modifications et du code source sur leur ordinateur.</li><li>Ils peuvent dont travailler en mode déconnecté (sans accès à Internet ou à un serveur centralisé) et ont accès à toutes les versions du code source.</li><li>Cela signifie qu&rsquo;<strong>il n&rsquo;y a pas de point unique de défaillance</strong>, car le référentiel de code est distribué sur plusieurs machines.</li></ul></section><section><h2 id=gitlab->GitLab ?</h2><ul><li><a href=https://about.gitlab.com/ target=_blank rel=noopener>GitLab</a> est une plateforme web open source de gestion de projets de développement de logiciels qui utilise Git pour la gestion de versions de code source.</li><li>GitLab fournit des fonctionnalités de collaboration supplémentaires telles que des tableaux de bord de suivi de projets, des outils de gestion de bugs ou bien encore des outils d&rsquo;intégration continue.</li><li>Il fournit également des fonctionnalités de gestion d&rsquo;équipe telles que la gestion des utilisateurs, des permissions et des groupes de projets.</li></ul></section></section><section><section data-shortcode-section><h1 id=premiers-pas>Premiers pas</h1><p>Installation et configuration de Git</p></section><section><h2 id=installation-de-git>Installation de Git</h2><h3 id=linux>Linux</h3><ul><li>Git est généralement installé directement dans la plupart des distributions Linux.</li><li>Sinon, il est installable dans un terminal au travers du gestionnaire de paquets de la distribution :<ul><li>Debian : <code>sudo apt install git-all</code></li><li>Fedora : <code>sudo dnf install git-all</code></li></ul></li></ul></section><section><h3 id=macos>macOS</h3><ul><li>Sur macOS Mavericks (10.9) ou ultérieur, Git est fourni au travers des Xcode Command Line Tools.</li><li>Il suffit d&rsquo;essayer de lancer Git dans un terminal via une commande comme <code>git --version</code> pour que macOS propose de l&rsquo;installer avec d&rsquo;autres outils de développement.</li><li>Sinon, il est possible d&rsquo;utiliser <a href=https://brew.sh/ target=_blank rel=noopener>Homebrew</a> via <code>brew install git</code> ou de <a href=https://git-scm.com/download/mac target=_blank rel=noopener>télécharger l&rsquo;installateur</a>.</li></ul></section><section><h3 id=windows>Windows</h3><ul><li>Sur Windows, l&rsquo;installation de Git est possible grâce au projet <a href=https://gitforwindows.org/ target=_blank rel=noopener>Git for Windows</a> qui fournit Git avec un émulateur de ligne de commande Bash.</li><li>Une façon simple de l&rsquo;installer de manière automatisée est d&rsquo;utiliser <a href=https://scoop.sh/ target=_blank rel=noopener>Scoop</a> pour installer Git avec la commande <code>scoop install git</code>.</li><li>Sinon, il est possible de <a href=https://git-scm.com/download/win target=_blank rel=noopener>télécharger l&rsquo;installateur via le site officiel</a> ou avec WinGet.</li></ul></section><section><h4 id=choix-de-léditeur-de-texte-par-défaut>Choix de l&rsquo;éditeur de texte par défaut</h4><img src=install/text_editor.png alt="Choosing the default editor used by Git" height=350><ul><li>Vim est un bon choix pour des utilisateurs habitués à utiliser des programmes en ligne de commande.</li><li>Sinon, il vaut mieux utiliser un éditeur avec une interface graphique comme Notepad++ ou VS Code.</li></ul></section><section><h4 id=nom-de-la-branche-initiale-dans-les-nouveaux-dépôts>Nom de la branche initiale dans les nouveaux dépôts</h4><img src=install/branch_name.png alt="Adjusting the name of the initial branch in new repositories" height=350><ul><li>Il est désormais recommandé pour travailler avec des outils tiers de sélectionner l&rsquo;option <em>Override the default branch name for new repositories</em> et de choisir <code>main</code> comme nom par défaut.</li></ul></section><section><h4 id=inscription-de-git-dans-les-variables-denvironnement>Inscription de Git dans les variables d&rsquo;environnement</h4><img src=install/path.png alt="Adjusting your PATH environment" height=275><ul><li><em>Git from the command line and also from 3rd-party software</em> permet d&rsquo;utiliser Git avec d&rsquo;autres logiciels installés sur l&rsquo;ordinateur, notamment des IDE.</li><li><em>Use Git and optional Unix tools from the Command Prompt</em> donne accès à des commandes Unix dans la ligne de commande Windows.</li></ul></section><section><h4 id=choix-de-lexécutable-ssh>Choix de l&rsquo;exécutable SSH</h4><img src=install/ssh.png alt="Choosing the SSH executable" height=350><ul><li>Depuis Windows 10, un client SSH est directement intégré à Windows. Il est donc possible de l&rsquo;utiliser en choisissant <em>Use external OpenSSH</em> pour mutualiser les configurations.</li></ul></section><section><h4 id=choix-du-magasin-de-certificats-https>Choix du magasin de certificats HTTPS</h4><img src=install/ca_cert.png alt="Choosing HTTPS transport backend" height=350><ul><li>L&rsquo;option <em>Use the native Windows Secure Channel library</em> permet de bénéficier des certificats de sécurité déployés dans un cadre professionnel via un domaine Active Directory.</li></ul></section><section><h4 id=conversion-des-fins-de-ligne>Conversion des fins de ligne</h4><img src=install/crlf.png alt="Configuring the line ending conventions" height=225><ul><li>À configurer en fonction des habitudes de l&rsquo;équipe :<ul><li><em>Checkout Windows-style, commit Unix-style line endings</em> est recommandé sous Windows pour un projet multi-plateformes.</li><li><em>Checkout as-is, commit Unix-style line endings</em> peut s&rsquo;utiliser si toute l&rsquo;équipe travaille avec des logiciels adaptés au monde Unix.</li></ul></li></ul></section><section><h4 id=comportement-par-défaut-du-pull>Comportement par défaut du pull</h4><img src=install/pull.png alt="Choose the default behavior of git pull" height=350><ul><li>À configurer en fonction des habitudes de l&rsquo;équipe.<ul><li>En l&rsquo;absence de préférence, l&rsquo;option <em>Default (fast-forward or merge)</em> est plus simple à appréhender dans un premier temps.</li></ul></li></ul></section><section><h2 id=configuration-de-git>Configuration de Git</h2><h3 id=niveaux-de-configuration>Niveaux de configuration</h3><div class=mermaid><pre>
    flowchart TD
      subgraph system
        subgraph global
          subgraph local
            node[Configuration]
          end
        end
      end
  </pre></div><ul><li>De manière générale, la configuration se définit à l&rsquo;échelle de l&rsquo;utilisateur, donc au niveau <code>global</code>.</li><li>Le niveau <code>local</code> peut également être utilisé pour des paramètres spécifiques à un projet.</li></ul></section><section><h3 id=configuration-minimale>Configuration minimale</h3><ul><li>La configuration de Git s&rsquo;effectue en ligne de commandes (CLI) dans un terminal.</li><li>Il faut au minimum configurer un nom d&rsquo;auteur et une adresse e-mail :</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git config --global user.name <span style=color:#e6db74>&#34;Prénom Nom&#34;</span>
</span></span><span style=display:flex><span>git config --global user.email <span style=color:#e6db74>&#34;utilisateur@domaine.tld&#34;</span>
</span></span></code></pre></div><ul><li>Dans un cadre professionnel, la configuration d&rsquo;un proxy peut également être nécessaire :</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span> git config --global http.proxy <span style=color:#e6db74>&#34;http://proxy.domaine.tld:port&#34;</span>
</span></span><span style=display:flex><span> git config --global https.proxy <span style=color:#e6db74>&#34;http://proxy.domaine.tld:port&#34;</span>
</span></span><span style=display:flex><span> git config --global no.proxy <span style=color:#e6db74>&#34;exception1,exception2,localhost&#34;</span>
</span></span></code></pre></div></section><section><h3 id=consulter-la-configuration-active>Consulter la configuration active</h3><ul><li>La commande <code>git config</code> permet également de connaître la valeur actuelle d&rsquo;un paramètre.</li><li>Il est même possible de consulter toute la configuration actuellement active grâce à la commande suivante :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git config --list
</span></span></code></pre></div><ul><li>L&rsquo;option <code>--show-origin</code> permet d&rsquo;indiquer en plus si une configuration vient du niveau <code>system</code>, <code>global</code> ou <code>local</code>.</li></ul></li></ul></section><section><h2 id=obtenir-de-laide>Obtenir de l&rsquo;aide</h2><ul><li>Git propose une aide intégrée (en anglais) sur son fonctionnement et la syntaxe de ses commandes. Cette aide est accessible via la commande :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git help &lt;commande&gt;
</span></span></code></pre></div><ul><li>En cas d&rsquo;utilisation de <code>git help</code> sans préciser de nom de commande, Git écrira dans le terminal une liste des commandes les plus usuelles.</li></ul></li></ul></section></section><section><section data-shortcode-section><h1 id=gérer-un-dépôt-git>Gérer un dépôt Git</h1><p>Créer un dépôt, écrire des commits, gérer des multiples branches, consulter et manipuler l&rsquo;historique</p></section><section><h2 id=quest-ce-quun-dépôt->Qu&rsquo;est-ce qu&rsquo;un dépôt ?</h2><ul><li>Un <strong>dépôt</strong> (ou &ldquo;repository&rdquo; en anglais) est l&rsquo;endroit où Git stocke l&rsquo;historique des versions d&rsquo;un projet de développement.</li><li>Il existe deux types de dépôts dans Git :<ul><li>Un <strong>dépôt local</strong> est une copie du dépôt sur l&rsquo;ordinateur local d&rsquo;un développeur</li><li>Un <strong>dépôt distant</strong> est un dépôt hébergé sur un serveur distant, accessible via Internet.</li></ul></li></ul></section><section><h2 id=créer-un-dépôt-local>Créer un dépôt local</h2><ul><li>Pour créer un dépôt local avec Git, il suffit de se positionner en ligne de commandes (via <code>cd</code>) dans un dossier à transformer en dépôt et d&rsquo;utiliser la commande :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git init
</span></span></code></pre></div><ul><li>Ceci va créer un sous-dossier <code>.git</code> (caché sous UNIX, pour le voir : <code>ls -la</code>) qui sert notamment à stocker l&rsquo;historique.<ul><li>Il n&rsquo;est pas utile d&rsquo;y accéder en utilisation courante.</li></ul></li></ul></li></ul></section><section><ul><li>Il est possible de consulter l&rsquo;état d&rsquo;un dépôt grâce à la commande :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git status
</span></span></code></pre></div><ul><li>Pour un dépôt nouvellement créé dans un dossier vide, elle doit proposer la sortie suivante :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>On branch main
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>No commits yet
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>nothing to commit (create/copy files and use &#34;git add&#34; to track)
</span></span></code></pre></div></li></ul></li></ul></section><section><h2 id=quest-ce-quun-commit->Qu&rsquo;est-ce qu&rsquo;un commit ?</h2><ul><li>Un <strong>commit</strong> représente une version spécifique d&rsquo;un projet à un moment donné. <strong>C&rsquo;est l&rsquo;unité de base de l&rsquo;historique d&rsquo;un dépôt.</strong><ul><li>Il contient une copie des fichiers du projet, ainsi qu&rsquo;un message décrivant les modifications apportées depuis la version précédente.</li></ul></li><li>Un commit est identifié par un <strong>hash</strong> (SHA-1) calculé par Git sur la base du hash de l&rsquo;ensemble des fichiers du projet.<ul><li>On l&rsquo;abrège souvent à ses premiers caractères (par exemple, <code>1d0703d3</code>).</li></ul></li></ul></section><section><h2 id=manipulation-des-fichiers>Manipulation des fichiers</h2><ul><li>Avec Git, un fichier peut être présent dans 3 zones distinctes :<ul><li>le répertoire de travail</li><li>l&rsquo;index</li><li>le dépôt</li></ul></li><li><code>git status</code> permet de connaître l&rsquo;état de chaque fichier</li></ul></section><section><h3 id=répertoire-de-travail>Répertoire de travail</h3><ul><li>Le <strong>répertoire de travail</strong> correspond au contenu du dossier sur l&rsquo;ordinateur du développeur.<ul><li>Par défaut, aucun fichier n&rsquo;est suivi par Git. Par exemple, après la création d&rsquo;un fichier <code>exemple.txt</code>, la commande <code>git status</code> donne la sortie suivante :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>On branch main
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  No commits yet
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  Untracked files:
</span></span><span style=display:flex><span>  (use &#34;git add &lt;file&gt;...&#34; to include in what will be committed)
</span></span><span style=display:flex><span>  exemple.txt
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  nothing added to commit but untracked files present (use &#34;git add&#34; to track)
</span></span></code></pre></div></li></ul></li></ul></section><section><div class=mermaid><pre>
    %%{init: {'theme': 'dark', 'themeVariables': { 'darkMode': true }}}%%
    classDiagram
      direction RL
      Index..Répertoire
      Dépôt..Index
      class Répertoire{
        +exemple.txt a4d584
      }
      class Index{
      }
      class Dépôt{
      }
  </pre></div></section><section><h3 id=index>Index</h3><ul><li>Pour demander à Git de commencer à suivre un fichier, il faut l&rsquo;ajouter à l&rsquo;<strong>index</strong>.</li><li>L&rsquo;index est une zone tampon entre le répertoire de travail et le dépôt qui rassemble l&rsquo;ensemble des modifications prêtes à être ajoutées à un commit.</li><li>Concrètement, on indexe un fichier avec la commande suivante :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git add &lt;fichier&gt;
</span></span></code></pre></div><ul><li>On peut utiliser un <code>.</code> à la place du nom du fichier pour demander à Git d&rsquo;indexer tout le répertoire de travail.</li></ul></li></ul></section><section><ul><li>Une fois un fichier indexé, il est prêt à être inclus à un commit. La sortie de <code>git status</code> reflète cette évolution :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>On branch main
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>No commits yet
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>Changes to be committed:
</span></span><span style=display:flex><span>(use &#34;git rm --cached &lt;file&gt;...&#34; to unstage)
</span></span><span style=display:flex><span>new file:   exemple.txt
</span></span></code></pre></div></li><li>Il est possible de désindexer un fichier sans le supprimer avec la commande :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git rm --cached &lt;fichier&gt;
</span></span></code></pre></div><ul><li>L&rsquo;option <code>-f</code> peut être utilisée à la place de <code>--cached</code> pour supprimer totalement le fichier.</li></ul></li></ul></section><section><ul><li>Un fichier indexé devient également suivi par Git, ce qui revient à dire que son hash est recalculé à chaque modification du répertoire de travail.</li><li>S&rsquo;il est à nouveau modifié alors qu&rsquo;il est toujours dans l&rsquo;index, Git détectera cette modification :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>On branch main
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>No commits yet
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>Changes to be committed:
</span></span><span style=display:flex><span>(use &#34;git rm --cached &lt;file&gt;...&#34; to unstage)
</span></span><span style=display:flex><span>new file:   exemple.txt
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>Changes not staged for commit:
</span></span><span style=display:flex><span>(use &#34;git add &lt;file&gt;...&#34; to update what will be committed)
</span></span><span style=display:flex><span>(use &#34;git restore &lt;file&gt;...&#34; to discard changes in working directory)
</span></span><span style=display:flex><span>modified:   exemple.txt
</span></span></code></pre></div></li></ul></section><section><div class=mermaid><pre>
    %%{init: {'theme': 'dark', 'themeVariables': { 'darkMode': true }}}%%
    classDiagram
      direction RL
      Index<|--Répertoire : git add
      Dépôt..Index
      class Répertoire{
        +exemple.txt a4d584
      }
      class Index{
        +exemple.txt a4d584
      }
      class Dépôt{
      }
  </pre></div></section><section><h3 id=dépôt>Dépôt</h3><ul><li>À partir du moment où un fichier est présent dans au moins un commit, il est alors enregistré dans le dépôt.</li><li>Un commit est composé de l&rsquo;ensemble des fichiers du dernier commit de la branche actuelle (HEAD) auxquels sont appliquées les modifications de l&rsquo;index.</li><li>Pour effectuer un commit, on utilise la commande suivante :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git commit -m <span style=color:#e6db74>&#34;Message de commit&#34;</span>
</span></span></code></pre></div></li></ul></section><section><ul><li>Une fois qu&rsquo;un commit est réalisé, il devient le nouveau commit de référence (HEAD) à partir duquel Git vérifie si un fichier a été modifié.</li><li>Quand une modification a été incluse dans un commit, elle sort de l&rsquo;index, comme en témoigne la sortie de <code>git status</code> :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>On branch main
</span></span><span style=display:flex><span>nothing to commit, working tree clean
</span></span></code></pre></div></li></ul></section><section><div class=mermaid><pre>
    %%{init: {'theme': 'dark', 'themeVariables': { 'darkMode': true }}}%%
    classDiagram
      direction RL
      Index..Répertoire
      Dépôt<|--Index : git commit
      class Répertoire{
        +exemple.txt a4d584
      }
      class Index{
      }
      class Dépôt{
        +exemple.txt a4d584
      }
  </pre></div></section><section><h4 id=messages-de-commit>Messages de commit</h4><ul><li>Le message de commit sera lisible par tous les développeurs du projet et sera retranscrit dans l&rsquo;historique, d&rsquo;où l&rsquo;importance qu&rsquo;il retrace fidèlement le contenu du commit.<ul><li>Il est donc crucial que les modifications apportées par un commit forment un ensemble cohérent.</li></ul></li><li>En utilisant la syntaxe <code>git commit -m</code>, la longueur du message est limitée à 49 caractères.<ul><li>Il vaut souvent mieux séparer un gros commit difficile à résumer en plusieurs petits commits.</li></ul></li></ul></section><section><h4 id=modifier-le-dernier-commit>Modifier le dernier commit</h4><ul><li>Il est possible de corriger un oubli sur le dernier commit ou de modifier son message avec l&rsquo;option <code>--amend</code> :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git commit --amend -m <span style=color:#e6db74>&#34;Nouveau message de commit&#34;</span>
</span></span></code></pre></div><ul><li>Pour ne pas modifier le message de commit, il faut ajouter l&rsquo;option <code>--no-edit</code> à la place de <code>-m</code>.</li></ul></li><li>Les modifications actuellement contenues dans l&rsquo;index seront alors fusionnées avec celles du dernier commit, ce qui va créer un nouveau commit qui remplace l&rsquo;ancien.</li></ul></section><section><h3 id=autres-manipulations-sur-les-fichiers>Autres manipulations sur les fichiers</h3><ul><li>Git propose des commandes permettant de retranscrire d&rsquo;autres manipulations usuelles sur les fichiers :<ul><li>Déplacer ou renommer un fichier :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git mv &lt;ancien_nom&gt; &lt;nouveau_nom&gt;
</span></span></code></pre></div></li><li>Supprimer un fichier :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git rm &lt;fichier_a_supprimer&gt;
</span></span></code></pre></div></li></ul></li><li>Ces modifications seront ajoutées à l&rsquo;index et devront être commitées pour être retranscrites dans le dépôt.</li></ul></section><section><h3 id=ignorer-des-fichiers>Ignorer des fichiers</h3><ul><li>Il est également possible de demander à Git d&rsquo;ignorer de manière permanente des fichiers.<ul><li>Pour cela, il faut créer à la racine du dépôt un fichier nommé <code>.gitignore</code> (sans extension), qui continent la liste des fichiers et dossiers à ignorer.</li><li>Le fichier <code>.gitignore</code> doit être commité pour être pris en compte.</li></ul></li><li>Il existe des outils en ligne comme <a href=https://www.toptal.com/developers/gitignore target=_blank rel=noopener>gitignore.io</a> pour avoir des listes usuelles de fichiers à ignorer selon les types de projets.</li></ul></section><section><h2 id=consulter-lhistorique-dun-dépôt>Consulter l&rsquo;historique d&rsquo;un dépôt</h2><div class=mermaid><pre>
    %%{init: {'theme': 'dark', 'themeVariables': { 'darkMode': true }}}%%
    gitGraph
      commit id: "3b1d805"
      commit id: "6a2b687"
      commit id: "49eb5d0"
      commit id: "8f7308f"
      commit id: "30d524c" tag: "HEAD"
  </pre></div></section><section><ul><li>La commande <code>git log</code> permet d&rsquo;obtenir l&rsquo;historique complet des commits d&rsquo;un dépôt, dans l&rsquo;ordre chronologique inversé :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git log
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>commit 30d524c6603ed1982bdf82eb54d7215a00b22328 (HEAD -&gt; main)
</span></span><span style=display:flex><span>Author: Maxence Lagalle &lt;contact@maxence.lagalle.fr&gt;
</span></span><span style=display:flex><span>Date:   Fri Apr 14 12:31:00 2023 +0200
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    Suppression du fichier exemple.txt devenu inutile
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>commit 8f7308fc1099a44fb25af05c3ee7c6a7ca17f111
</span></span><span style=display:flex><span>Author: Maxence Lagalle &lt;contact@maxence.lagalle.fr&gt;
</span></span><span style=display:flex><span>Date:   Fri Apr 14 12:30:31 2023 +0200
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    Correction d&#39;une coquille dans le poème
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>commit 49eb5d06716e1f0668681b417a884b3d808bacda
</span></span><span style=display:flex><span>Author: Maxence Lagalle &lt;contact@maxence.lagalle.fr&gt;
</span></span><span style=display:flex><span>Date:   Fri Apr 14 12:30:02 2023 +0200
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    Le poème est plutôt un haiku
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>commit 6a2b687e994b4c8341adc6542c313cb860dad452
</span></span><span style=display:flex><span>Author: Maxence Lagalle &lt;contact@maxence.lagalle.fr&gt;
</span></span><span style=display:flex><span>Date:   Fri Apr 14 12:29:24 2023 +0200
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    Ajout d&#39;un poème sur l&#39;informatique
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>commit 3b1d805510f43af8e7b9da97d0bf44dca127a9d1
</span></span><span style=display:flex><span>Author: Maxence Lagalle &lt;contact@maxence.lagalle.fr&gt;
</span></span><span style=display:flex><span>Date:   Thu Apr 13 16:56:41 2023 +0200
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    Exemple de commit avec un fichier unique
</span></span></code></pre></div></li></ul></section><section><ul><li>L&rsquo;option <code>--oneline</code> permet d&rsquo;obtenir un affichage compact, avec une seule ligne par commit :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git log --oneline
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>30d524c (HEAD -&gt; main) Suppression du fichier exemple.txt devenu inutile
</span></span><span style=display:flex><span>8f7308f Correction d&#39;une coquille dans le poème
</span></span><span style=display:flex><span>49eb5d0 Le poème est plutôt un haiku
</span></span><span style=display:flex><span>6a2b687 Ajout d&#39;un poème sur l&#39;informatique
</span></span><span style=display:flex><span>3b1d805 Exemple de commit avec un fichier unique
</span></span></code></pre></div></li></ul></section><section><ul><li>L&rsquo;option <code>--stat</code> permet de connaître le nombre de modifications effectuées sur chaque fichier :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git log --stat
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>commit 30d524c6603ed1982bdf82eb54d7215a00b22328 (HEAD -&gt; main)
</span></span><span style=display:flex><span>Author: Maxence Lagalle &lt;contact@maxence.lagalle.fr&gt;
</span></span><span style=display:flex><span>Date:   Fri Apr 14 12:31:00 2023 +0200
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    Suppression du fichier exemple.txt devenu inutile
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>exemple.txt | 0
</span></span><span style=display:flex><span>1 file changed, 0 insertions(+), 0 deletions(-)
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>commit 8f7308fc1099a44fb25af05c3ee7c6a7ca17f111
</span></span><span style=display:flex><span>Author: Maxence Lagalle &lt;contact@maxence.lagalle.fr&gt;
</span></span><span style=display:flex><span>Date:   Fri Apr 14 12:30:31 2023 +0200
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    Correction d&#39;une coquille dans le poème
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>haiku.txt | 2 +-
</span></span><span style=display:flex><span>1 file changed, 1 insertion(+), 1 deletion(-)
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>commit 49eb5d06716e1f0668681b417a884b3d808bacda
</span></span><span style=display:flex><span>Author: Maxence Lagalle &lt;contact@maxence.lagalle.fr&gt;
</span></span><span style=display:flex><span>Date:   Fri Apr 14 12:30:02 2023 +0200
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    Le poème est plutôt un haiku
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>poeme.txt =&gt; haiku.txt | 0
</span></span><span style=display:flex><span>1 file changed, 0 insertions(+), 0 deletions(-)
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>commit 6a2b687e994b4c8341adc6542c313cb860dad452
</span></span><span style=display:flex><span>Author: Maxence Lagalle &lt;contact@maxence.lagalle.fr&gt;
</span></span><span style=display:flex><span>Date:   Fri Apr 14 12:29:24 2023 +0200
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    Ajout d&#39;un poème sur l&#39;informatique
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>poeme.txt | 3 +++
</span></span><span style=display:flex><span>1 file changed, 3 insertions(+)
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>commit 3b1d805510f43af8e7b9da97d0bf44dca127a9d1
</span></span><span style=display:flex><span>Author: Maxence Lagalle &lt;contact@maxence.lagalle.fr&gt;
</span></span><span style=display:flex><span>Date:   Thu Apr 13 16:56:41 2023 +0200
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    Exemple de commit avec un fichier unique
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>exemple.txt | 0
</span></span><span style=display:flex><span>1 file changed, 0 insertions(+), 0 deletions(-)
</span></span></code></pre></div></li><li>Il est possible de combiner les options <code>--oneline</code> et <code>--stat</code>.</li></ul></section><section><h3 id=filtrer-lhistorique>Filtrer l&rsquo;historique</h3><ul><li><code>git log</code> supporte de nombreuses options permettant de filtrer l&rsquo;historique selon plusieurs critères :<ul><li><code>-n &lt;nombre></code> : n derniers commits</li><li><code>--before="AAAA-MM-JJ HH:mm"</code> : commits plus anciens qu&rsquo;une date</li><li><code>--after="AAAA-MM-JJ HH:mm"</code> : commits plus récents qu&rsquo;une date</li><li><code>--author="Nom"</code> : commits signés par un auteur</li><li><code>-- &lt;fichier></code> : commits affectant un fichier</li></ul></li></ul></section><section><h3 id=rechercher-à-lintérieur-des-commits>Rechercher à l&rsquo;intérieur des commits</h3><ul><li>L&rsquo;option <code>-S</code> permet de rechercher une chaîne de caractères et d&rsquo;afficher la liste des commits contenant cette chaîne à l&rsquo;intérieur des fichiers qu&rsquo;ils modifient :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git log -S <span style=color:#e6db74>&#34;Chaîne à rechercher&#34;</span>
</span></span></code></pre></div></li><li>Il existe également l&rsquo;option <code>-G</code> pour faire une recherche par expression régulière (regex).</li></ul></section><section><h3 id=consulter-lhistorique-détaillé-dun-fichier>Consulter l&rsquo;historique détaillé d&rsquo;un fichier</h3><ul><li>La commande <code>git blame</code> permet de connaître l&rsquo;historique détaillé d&rsquo;un fichier en précisant de quel commit viennent chacune de ses lignes dans leur rédaction actuelle :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git blame &lt;fichier&gt;
</span></span></code></pre></div><ul><li>La sortie de cette commande affiche chaque ligne du fichier dans le terminal, précédé de l&rsquo;identifiant du commit ayant introduit ou modifié cette ligne, du nom de l&rsquo;auteur et de la date de ce commit.</li></ul></li></ul></section><section><ul><li>Exemple :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git blame haiku.txt
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>6a2b687e poeme.txt (Maxence Lagalle 2023-04-14 12:29:24 +0200 1) Un clic malencontreux
</span></span><span style=display:flex><span>8f7308fc haiku.txt (Maxence Lagalle 2023-04-14 12:30:31 +0200 2) Fichier important supprimé
</span></span><span style=display:flex><span>6a2b687e poeme.txt (Maxence Lagalle 2023-04-14 12:29:24 +0200 3) Sauvegarde ? Jamais fait.
</span></span></code></pre></div></li></ul></section><section><h3 id=comparer-deux-commits>Comparer deux commits</h3><ul><li>Grâce à <code>git diff</code>, il est possible d&rsquo;effectuer des comparaisons entre deux états d&rsquo;un fichier.<ul><li>Si la commande est utilisée sans paramètres, la comparaison s&rsquo;effectue entre le répertoire de travail et l&rsquo;index.</li><li>Il est possible de donner en paramètres un identifiant de commit pour comparer ce commit au répertoire de travail, ou deux identifiants de commit pour les comparer.</li></ul></li></ul></section><section><ul><li>Par exemple, il est possible de comparer le commit <code>49eb5d0</code> à l&rsquo;état actuel du dépôt, c&rsquo;est-à-dire au commit <code>HEAD</code>:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git diff 49eb5d0 HEAD
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>diff --git a/exemple.txt b/exemple.txt
</span></span><span style=display:flex><span>deleted file mode 100644
</span></span><span style=display:flex><span>index e69de29..0000000
</span></span><span style=display:flex><span>diff --git a/haiku.txt b/haiku.txt
</span></span><span style=display:flex><span>index b3c75e6..2ba1e15 100644
</span></span><span style=display:flex><span><span style=color:#f92672>--- a/haiku.txt
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+++ b/haiku.txt
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span><span style=color:#75715e>@@ -1,3 +1,3 @@
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>Un clic malencontreux
</span></span><span style=display:flex><span><span style=color:#f92672>-Fichier portant supprimé
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+Fichier important supprimé
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span>Sauvegarde ? Jamais fait.
</span></span><span style=display:flex><span>\ No newline at end of file
</span></span></code></pre></div></li></ul></section><section><h3 id=rechercher-un-commit-défectueux>Rechercher un commit défectueux</h3><ul><li>L&rsquo;outil <code>git bisect</code> permet de retrouver un commit défectueux (par exemple, ayant introduit un bug) par recherche dichotomique.</li><li>Il faut tout d&rsquo;abord l&rsquo;initialiser en lui précisant notamment l&rsquo;identifiant d&rsquo;un &ldquo;mauvais commit&rdquo; (ayant le problème) et d&rsquo;un &ldquo;bon commit&rdquo; (n&rsquo;ayant pas le problème) :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git bisect start
</span></span><span style=display:flex><span>git bisect bad &lt;mauvais commit, vide pour commit actuel&gt;
</span></span><span style=display:flex><span>git bisect good &lt;bon commit&gt;
</span></span></code></pre></div></li></ul></section><section><ul><li>Git va alors sélectionner un commit situé entre ces deux bornes et remettre le répertoire de travail à l&rsquo;état de ce commit :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>Bisecting: X revisions left to test after this (roughly Y steps)
</span></span></code></pre></div></li><li>Après avoir vérifié manuellement si le bug est toujours présent, il faut indiquer à Git le résultat de cette vérification avec l&rsquo;une de ces commandes :<ul><li><code>git bisect good</code> si le bug est absent</li><li><code>git bisect bad</code> si le bug est présent</li></ul></li></ul></section><section><ul><li>Lorsque Git a réussi à repérer le commit ayant introduit le bug, il indique son identifiant dans la sortie du terminal, ainsi que les détails du commit :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>8f7308fc1099a44fb25af05c3ee7c6a7ca17f111 is the first bad commit
</span></span><span style=display:flex><span>commit 8f7308fc1099a44fb25af05c3ee7c6a7ca17f111
</span></span><span style=display:flex><span>...
</span></span></code></pre></div></li><li>Pour sortir du mode de recherche et revenir à l&rsquo;état initial du répertoire de travail, il faut réinitialiser git bisect via :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git bisect reset
</span></span></code></pre></div></li></ul></section><section><h3 id=annuler-un-commit>Annuler un commit</h3><ul><li>Git propose un mécanisme de <code>revert</code> permettant d&rsquo;annuler les modifications d&rsquo;un commit. Il consiste à écrire un nouveau commit qui continent l&rsquo;inverse des modifications du commit original. Ce mécanisme s&rsquo;utilise avec la commande suivante :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git revert &lt;commit_a_annuler&gt;
</span></span></code></pre></div><ul><li>Ce nouveau commit s&rsquo;inscrit dans l&rsquo;historique au moment où il est créé, comme n&rsquo;importe quel autre commit.</li></ul></li></ul></section><section><h3 id=revenir-à-un-état-antérieur-de-lhistorique>Revenir à un état antérieur de l&rsquo;historique</h3><ul><li>Git permet facilement de revenir à un état antérieur, par exemple pour repartir d&rsquo;une version précédente ou annuler des modifications expérimentales.</li><li>Pour cela, il faut utiliser la commande :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git reset &lt;commit&gt;
</span></span></code></pre></div><ul><li>Le répertoire de travail est alors remis à l&rsquo;état du commit ciblé et les modifications réalisées depuis sont remises dans l&rsquo;index.</li><li>L&rsquo;option <code>--hard</code> permet de réinitialiser <strong>définitivement</strong> le répertoire de travail et l&rsquo;index et supprime les commits devenus obsolètes.</li></ul></li></ul></section><section><h2 id=tags>Tags</h2><ul><li>Les tags sont un moyen simple d&rsquo;associer une étiquette (généralement, un numéro de version) à un commit.</li><li>Une fois qu&rsquo;ils sont positionnés, les tags peuvent être utilisés à la place des identifiants de commits dans presque toutes les commandes de Git.</li></ul></section><section><h3 id=ajouter-un-tag>Ajouter un tag</h3><ul><li>Ajouter un tag s&rsquo;effectue avec la commande :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git tag &lt;nom_du_tag&gt; &lt;commit&gt;
</span></span></code></pre></div><ul><li>Si aucun identifiant de commit n&rsquo;est précisé, le tag s&rsquo;appliquera au dernier commit (HEAD).</li><li>Il est possible d&rsquo;ajouter des informations détaillées à un tag (par exemple, un changelog) en ajoutant l&rsquo;option <code>-a</code>.</li></ul></li></ul></section><section><h3 id=manipuler-les-tags>Manipuler les tags</h3><ul><li>Git peut fournir la liste des tags d&rsquo;un dépôt :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git tag --list
</span></span></code></pre></div></li><li>Il est également possible d&rsquo;afficher les détails d&rsquo;un tag, notamment sa date et son auteur :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git tag show &lt;nom_du_tag&gt;
</span></span></code></pre></div></li><li>Enfin, il est possible de supprimer un tag :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git tag -d &lt;nom_du_tag&gt;
</span></span></code></pre></div></li></ul></section><section><h2 id=utiliser-plusieurs-branches>Utiliser plusieurs branches</h2><ul><li>Avec celle de commit, la notion de branche et l&rsquo;un des concepts clés de Git.<ul><li>La maîtriser permet de considérablement simplifier le travail collaboratif.</li></ul></li><li>Une branche est un <strong>enchaînement de commits parallèle</strong> à la version principale du projet.<ul><li>Par convention, la version principale est la branche <code>main</code> (anciennement <code>master</code>).</li></ul></li></ul></section><section><ul><li>Techniquement, une branche est un tag dynamique qui se déplace automatiquement sur le dernier commit en date de sa lignée.<ul><li><code>HEAD</code> est le tag du dernier commit de la branche actuellement active.</li></ul></li></ul><div class=mermaid><pre>
    %%{init: {'theme': 'dark', 'themeVariables': { 'darkMode': true }}}%%
    gitGraph
      commit
      commit
      branch feature
      commit
      commit
      checkout main
      commit tag: "main"
      checkout feature
      commit tag: "feature, HEAD"
  </pre></div><ul><li>Sur cet exemple, <code>feature</code> est la branche active.</li></ul></section><section><h3 id=lister-les-branches-dun-dépôt>Lister les branches d&rsquo;un dépôt</h3><ul><li>Pour lister les branches d&rsquo;un dépôt, la commande à utiliser est <code>git branch</code> :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git branch
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>* feature
</span></span><span style=display:flex><span>  main
</span></span></code></pre></div><ul><li>La branche actuellement active est signalée par l&rsquo;astérisque (<code>*</code>)</li><li>L&rsquo;option <code>-v</code> permet d&rsquo;afficher en plus l&rsquo;identifiant et le message du dernier commit de chaque branche</li></ul></li></ul></section><section><h3 id=créer-une-branche>Créer une branche</h3><ul><li>La création de branche s&rsquo;effectue également grâce à <code>git branch</code> :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git branch &lt;nom_de_la_branche&gt; &lt;commit_initial&gt;
</span></span></code></pre></div><ul><li>Si aucun commit initial n&rsquo;est précisé, <code>HEAD</code> sera le point de départ de la nouvelle branche.</li><li>Le nom d&rsquo;une branche :<ul><li>ne peut contenir que des caractères ASCII</li><li>ne dois pas commencer par un tiret</li><li>ne dois pas contenir deux points consécutifs</li><li>ne dois pas se terminer par un slash, mais peut en contenir pour créer une hiérarchie</li></ul></li></ul></li></ul></section><section><h3 id=changer-de-branche>Changer de branche</h3><ul><li><code>git switch</code> permet de changer la branche active :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git switch &lt;branche_a_activer&gt;
</span></span></code></pre></div><ul><li>Pour les versions de Git antérieures à 2.23.0, la commande était <code>git checkout &lt;branche></code></li><li>Tous les nouveaux commits seront affiliés à la branche activée</li><li>Changer de branche :<ul><li>Modifie le répertoire de travail et l&rsquo;index</li><li>Préserve les modifications en cours</li><li>Déplace l&rsquo;étiquette <code>HEAD</code></li></ul></li></ul></li></ul></section><section><h3 id=mettre-de-côté-les-modifications-en-cours>Mettre de côté les modifications en cours</h3><ul><li>Il peut arriver que l&rsquo;on souhaite temporairement mettre de côté des modifications en cours, par exemple pour travailler en urgence sur un problème.</li><li>Git rend cela possible grâce à la commande :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git stash
</span></span></code></pre></div><ul><li>Cette commande stocke temporairement les modifications du répertoire de travail et de l&rsquo;index, et remet le répertoire de travail à l&rsquo;état du dernier commit de la branche.</li><li>L&rsquo;option <code>--include-untracked</code> permet d&rsquo;également inclure les fichiers non suivis par Git.</li></ul></li></ul></section><section><ul><li>Pour réappliquer dans la branche active les dernières modifications mises de côté, la commande est :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git stash pop
</span></span></code></pre></div></li><li>Il est également possible de supprimer des modifications sans les appliquer :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git stash drop
</span></span></code></pre></div></li><li>Enfin, il est possible d&rsquo;accumuler plusieurs stashes, qui peuvent être listés :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git stash list
</span></span></code></pre></div></li></ul></section><section><h3 id=fusionner-deux-branches>Fusionner deux branches</h3><ul><li>Fusionner des branches permet d&rsquo;intégrer des modifications faites sur une branche dans une autre.<ul><li>C&rsquo;est une opération cruciale, car elle permet par exemple d&rsquo;intégrer à une version des productions des fonctionnalités développées en parallèle.</li></ul></li><li>La fusion doit être initiée en ayant activé la branche cible (celle qui doit recevoir les modifications)<ul><li>La fusion s&rsquo;effectue avec la commande <code>git merge</code>, en précisant la branche source des modifications :</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git merge &lt;branche_source&gt;
</span></span></code></pre></div></li></ul></section><section><div class=mermaid><pre>
    %%{init: {'theme': 'dark', 'themeVariables': { 'darkMode': true }}}%%
    gitGraph
      commit
      commit id: "1-8a4f40a"
      branch feature
      commit
      commit
      checkout main
      commit
      checkout feature
      commit tag: "feature"
      checkout main
      merge feature id: "6-1a59d24" tag: "main, HEAD"
  </pre></div><ul><li>Git recherche l&rsquo;ancêtre commun des branches à fusionner (ici, <code>1-8a4f40a</code>) et y injecte les modifications issues de chaque branche, pour créer un nouveau commit dans la branche active, dit commit de merge.<ul><li>Ici, le commit de merge a l&rsquo;identifiant <code>6-1a59d24</code>.</li></ul></li></ul></section><section><div class=mermaid><pre>
  classDiagram
    direction LR
    Commit1..Commit4
    Commit1..Commit5
    Commit4..Commit6
    Commit5..Commit6
    class Commit1 {
      fichier1.txt 41ad58
      fichier2.txt 1efc25
      fichier3.txt 690a41
    }
    class Commit4 {
      fichier1.txt 914da0
      fichier2.txt 1efc25
      fichier3.txt 690a41
    }
    class Commit5 {
      fichier1.txt 41ad58
      fichier2.txt ea451d
      fichier3.txt 690a41
    }
    class Commit6 {
      fichier1.txt 914da0
      fichier2.txt ea451d
      fichier3.txt 690a41
    }
  </pre></div></section><section><h4 id=fusion-fast-forward>Fusion Fast-Forward</h4><ul><li>Si le commit de merge calculé par Git est égal au dernier commit de la branche source (il a le même hash), alors Git évite de créer un doublon.</li><li>À la place, il procède à une fusion <em>fast-forward</em> en déplaçant l&rsquo;étiquette de la branche cible sur le commit de la branche source.</li></ul><div class=mermaid><pre>
    %%{init: {'theme': 'dark', 'themeVariables': { 'darkMode': true }}}%%
    gitGraph
      commit
      commit
      branch feature
      commit
      commit
      checkout main
      merge feature tag: "main, feature, HEAD"
  </pre></div></section><section><h4 id=conflits-de-fusion>Conflits de fusion</h4><ul><li>Un conflit de fusion survient si la même zone d&rsquo;un même fichier a été modifiée entre l&rsquo;ancêtre commun d&rsquo;une part et les branches source et cible simultanément d&rsquo;autre part.<ul><li>Une zone d&rsquo;un fichier correspond généralement à une ligne et son voisinage immédiat.</li></ul></li><li>Dans ce cas, Git suspend la fusion et le développeur doit trancher manuellement le conflit en indiquant quelle version conserver.</li></ul></section><section><ul><li><p>Git signale l&rsquo;échec de la fusion automatique et les conflits dans la sortie de la commande <code>git merge</code> :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>Auto-merging sonnet.txt
</span></span><span style=display:flex><span>CONFLICT (add/add): Merge conflict in sonnet.txt
</span></span><span style=display:flex><span>Automatic merge failed; fix conflicts and then commit the result.
</span></span></code></pre></div></li><li><p>La commande <code>git status</code> précise également qu&rsquo;une fusion est en cours et la liste des fichiers en conflit :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>On branch main
</span></span><span style=display:flex><span>You have unmerged paths.
</span></span><span style=display:flex><span>(fix conflicts and run &#34;git commit&#34;)
</span></span><span style=display:flex><span>(use &#34;git merge --abort&#34; to abort the merge)
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>Unmerged paths:
</span></span><span style=display:flex><span>(use &#34;git add &lt;file&gt;...&#34; to mark resolution)
</span></span><span style=display:flex><span>both added:      sonnet.txt
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>no changes added to commit (use &#34;git add&#34; and/or &#34;git commit -a&#34;)
</span></span></code></pre></div></li></ul></section><section><h4 id=résoudre-les-conflits-de-fusion>Résoudre les conflits de fusion</h4><ul><li>Pour résoudre les conflits, le développeur doit ouvrir dans un éditeur de texte les fichiers concernés.</li><li>Git a inséré dans le fichier des informations sur les modifications effectuées dans les branches source et cible sous le format suivant :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
</span></span><span style=display:flex><span>Version de la branche cible
</span></span><span style=display:flex><span>=======
</span></span><span style=display:flex><span>Version de la branche source
</span></span><span style=display:flex><span>&gt;&gt;&gt;&gt;&gt;&gt;&gt; source
</span></span></code></pre></div><ul><li>Si une zone est vide, c&rsquo;est qu&rsquo;elle n&rsquo;existe pas dans la branche concernée.</li></ul></li></ul></section><section><ul><li>Il est possible, et souvent utile, d&rsquo;afficher également des informations sur le contenu de l&rsquo;ancêtre commun via une option de configuration de Git :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git config --global merge.conflictstyle diff3
</span></span></code></pre></div><ul><li>Dans ce cas, les informations sur les modifications adopteront la présentation suivante :</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
</span></span><span style=display:flex><span>Version de la branche cible
</span></span><span style=display:flex><span>||||||| merged common ancestor
</span></span><span style=display:flex><span>Version de l&#39;ancêtre commun
</span></span><span style=display:flex><span>=======
</span></span><span style=display:flex><span>Version de la branche source
</span></span><span style=display:flex><span>&gt;&gt;&gt;&gt;&gt;&gt;&gt; source
</span></span></code></pre></div></li></ul></section><section><ul><li>Une fois le fichier ouvert dans l&rsquo;éditeur de texte, il est possible de reprendre à l&rsquo;identique l&rsquo;une des versions proposées, ou d&rsquo;en écrire une nouvelle.</li><li>Lorsque tous les conflits d&rsquo;un fichier sont résolus (il n&rsquo;y a plus de marqueurs ajoutés par Git), le fichier doit être indexé (<code>git add</code>)</li><li>Après la résolution du dernier fichier, l&rsquo;index peut finalement être commité (<code>git commit</code>), ce qui permettra de finaliser le commit de merge et la fusion des branches.</li></ul></section><section><h5 id=exemple>Exemple</h5><ul><li>Fichier <code>sonnet.txt</code> avant résolution des conflits :</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
</span></span><span style=display:flex><span>=======
</span></span><span style=display:flex><span>Quand l&#39;écran s&#39;allume, je tape sur mon clavier,
</span></span><span style=display:flex><span>Et je me sens l&#39;âme d&#39;un héros bien armé,
</span></span><span style=display:flex><span>Mais parfois c&#39;est la guerre, les bugs sont aguerris,
</span></span><span style=display:flex><span>Et je dois me résoudre à un peu de répit.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&gt;&gt;&gt;&gt;&gt;&gt;&gt; alt-sonnet
</span></span><span style=display:flex><span>Sur mon écran s&#39;affichent des pixels brillants,
</span></span><span style=display:flex><span>Des octets bien alignés, des programmes ardents,
</span></span><span style=display:flex><span>Des virus dévastateurs, des spams envahissants,
</span></span><span style=display:flex><span>Des câbles emmêlés, des bugs persistants.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
</span></span><span style=display:flex><span>Je pianote sur mon clavier, tel un virtuose,
</span></span><span style=display:flex><span>Je créé des dossiers, des fichiers grandioses,
</span></span><span style=display:flex><span>Je navigue sur le web, je me sens comme un rose,
</span></span><span style=display:flex><span>Mais parfois je m&#39;emmêle, je suis un peu névrose.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Je rêve de machines, de logiciels parfaits,
</span></span><span style=display:flex><span>De claviers qui répondent à mes moindres souhaits,
</span></span><span style=display:flex><span>De souris magiques qui font tout à ma place.
</span></span><span style=display:flex><span>=======
</span></span><span style=display:flex><span>Je rêve de machines, de logiciels parfaits,
</span></span><span style=display:flex><span>D&#39;ordinateurs qui pensent, qui lisent dans mes traits,
</span></span><span style=display:flex><span>De robots programmés, qui m&#39;apportent le café.
</span></span><span style=display:flex><span>&gt;&gt;&gt;&gt;&gt;&gt;&gt; alt-sonnet
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Mais en attendant, je m&#39;en remets à mon ordinateur,
</span></span><span style=display:flex><span>Avec ses programmes parfois un peu farfelus,
</span></span><span style=display:flex><span>Et je souris, car je sais qu&#39;il est mon sauveur.
</span></span></code></pre></div></section><section><ul><li>Fichier <code>sonnet.txt</code> après résolution des conflits :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>Quand l&#39;écran s&#39;allume, je tape sur mon clavier,
</span></span><span style=display:flex><span>Et je me sens l&#39;âme d&#39;un héros bien armé,
</span></span><span style=display:flex><span>Mais parfois c&#39;est la guerre, les bugs sont aguerris,
</span></span><span style=display:flex><span>Et je dois me résoudre à un peu de répit.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Je pianote sur mon clavier, tel un virtuose,
</span></span><span style=display:flex><span>Je créé des dossiers, des fichiers grandioses,
</span></span><span style=display:flex><span>Je navigue sur le web, je me sens comme un rose,
</span></span><span style=display:flex><span>Mais parfois je m&#39;emmêle, je suis un peu névrose.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Je rêve de machines, de logiciels parfaits,
</span></span><span style=display:flex><span>D&#39;ordinateurs qui pensent, qui lisent dans mes traits,
</span></span><span style=display:flex><span>De robots programmés, qui m&#39;apportent le café.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Mais en attendant, je m&#39;en remets à mon ordinateur,
</span></span><span style=display:flex><span>Avec ses programmes parfois un peu farfelus,
</span></span><span style=display:flex><span>Et je souris, car je sais qu&#39;il est mon sauveur.
</span></span></code></pre></div><ul><li>Le premier conflit a été résolu en conservant la version de <code>alt-sonnet</code></li><li>Le second par une ré-écriture mélangeant les deux versions et supprimant un texte commun</li></ul></li></ul></section><section><ul><li>La commande <code>git status</code> permet de confirmer que la fusion est terminée après commit des modifications :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>On branch main
</span></span><span style=display:flex><span>nothing to commit, working tree clean
</span></span></code></pre></div></li><li>En cas de difficultés, il est possible d&rsquo;abandonner une fusion pour la recommencer ultérieurement ou avec d&rsquo;autres branches :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git merge --abort
</span></span></code></pre></div></li></ul></section><section><h3 id=linéariser-un-historique>Linéariser un historique</h3><ul><li>Pour des raisons de lisibilité, on peut vouloir rendre aussi linéaire que possible l&rsquo;historique d&rsquo;une branche, en particulier de la branche principale.</li><li>Git propose des approches permettant de récupérer tout ou partie des modifications d&rsquo;une autre branche tout en conservant un historique clair.</li></ul></section><section><h4 id=récupérer-un-commit--le-cherry-pick>Récupérer un commit : le cherry pick</h4><ul><li>Git permet de récupérer dans une branche les modifications apportées par un commit réalisé dans une autre branche avec la commande <code>git cherry-pick</code> :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git cherry-pick &lt;identifiant_commit&gt;
</span></span></code></pre></div><ul><li>En cas de conflit, la même mécanique de résolution des conflits que pour la fusion de branches sera déclenchée</li></ul></li></ul></section><section><div class=mermaid><pre>
    %%{init: {'theme': 'dark', 'themeVariables': { 'darkMode': true }}}%%
    gitGraph
      commit
      commit
      branch feature
      commit id: "2-7ed128b" tag: "feature"
      checkout main
      commit
      cherry-pick id: "2-7ed128b"
      commit
      commit tag: "main, HEAD"
  </pre></div><ul><li>Le commit <code>2-7ed128b</code>, initialement présent dans la branche <code>feature</code> a été intégré sans fusion à l&rsquo;historique de la branche <code>main</code>.</li></ul></section><section><h4 id=réécrire-une-branche-dans-une-autre--le-rebase>Réécrire une branche dans une autre : le rebase</h4><ul><li>Le rebase est une autre façon de fusionner deux branches.<ul><li>Au lieu d&rsquo;écrire un commit de merge, le rebase consiste à intégrer tous les commits de la branche source dans la branche cible.</li><li>Une fois positionné dans la branche cible, la commande <code>git rebase</code> permet d&rsquo;effectuer cette opération :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git rebase &lt;branche_source&gt;
</span></span></code></pre></div></li></ul></li></ul></section><section><ul><li>Les commits de la branche source seront réécrits dans la branche cible dans le même ordre, immédiatement après l&rsquo;ancêtre commun.</li><li>Les conflits devront être résolus après chaque commit, pour permettre à l&rsquo;opération de continuer :<ul><li>Les fichiers en conflit doivent être ajoutés à l&rsquo;index avec <code>git add</code></li><li>Puis, il faut demander à Git de continuer le rebase avec la commande :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git rebase --continue
</span></span></code></pre></div></li></ul></li></ul></section><section><h5 id=comparaison-entre-merge-et-rebase>Comparaison entre merge et rebase</h5><ul><li>Exemple d&rsquo;historique après un <code>git merge</code> :</li></ul><div class=mermaid><pre>
    %%{init: {'theme': 'dark', 'themeVariables': { 'darkMode': true }}}%%
    gitGraph
      commit id: "0-71af11d"
      commit id: "1-8a4f40a"
      branch feature
      commit id: "2-9358c74"
      commit id: "3-8151b64"
      checkout main
      commit id: "4-09aa3e3"
      checkout feature
      commit id: "5-af29107" tag: "feature"
      checkout main
      merge feature id: "6-1a59d24"
      commit id: "7-46ccbcb" tag: "main, HEAD"
  </pre></div><ul><li>Le même historique après un <code>git rebase</code>:</li></ul><div class=mermaid><pre>
    %%{init: {'theme': 'dark', 'themeVariables': { 'darkMode': true }}}%%
    gitGraph
      commit id: "0-71af11d"
      commit id: "1-8a4f40a"
      commit id: "2-9358c74"
      commit id: "3-8151b64"
      commit id: "5-af29107"
      commit id: "4-09aa3e3"
      commit id: "6-1a59d24"
      commit id: "7-46ccbcb" tag: "main, HEAD"
  </pre></div></section><section><h4 id=simplifier-lhistorique--le-squash>Simplifier l&rsquo;historique : le squash</h4><ul><li>Le <code>squash</code> permet à Git de rassembler plusieurs commits en un seul au moment d&rsquo;une fusion, ce qui est une autre façon de linéariser un historique tout en le simplifiant.<ul><li>La manière la plus simple d&rsquo;y parvenir est d&rsquo;ajouter l&rsquo;option <code>--squash</code> à <code>git merge</code>:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git merge --squash &lt;branche_source&gt;
</span></span></code></pre></div></li><li>Cette opération écrit dans l&rsquo;index la combinaison de tous les commits de la branche source.</li><li>Il faut ensuite effectuer un commit classique pour terminer la fusion.</li></ul></li></ul></section><section><h3 id=supprimer-une-branche>Supprimer une branche</h3><ul><li>L&rsquo;option <code>-d</code> de <code>git branch</code> permet de supprimer une branche :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git branch -d &lt;branche_a_supprimer&gt;
</span></span></code></pre></div><ul><li>La suppression ne doit être effectuée que si la branche est devenue inutile :<ul><li>Parce qu&rsquo;elle a été fusionnées dans une autre</li><li>Parce que ses modifications ont été abandonnées (l&rsquo;option devient alors <code>-D</code> par sécurité)</li></ul></li><li>Une fois la branche supprimée, ses commits non fusionnés sont définitivement perdus</li></ul></li></ul></section></section><section><section data-shortcode-section><h1 id=travailler-avec-une-forge-logicielle>Travailler avec une forge logicielle</h1><p>Se synchroniser avec un dépôt distant et travailler de manière collaborative, exploiter les fonctionnalités de la forge logicielle GitLab</p></section><section><h2 id=forge-logicielle->Forge logicielle ?</h2><ul><li>Une forge logicielle est une plateforme web qui permet aux développeurs de gérer leur code source, de collaborer sur des projets de développement, de suivre les bugs et les problèmes, et de déployer des applications.</li><li>Outre le suivi de version basé sur Git, les forges logicielles incluent des fonctionnalités comme la création de merge requests, la gestion de bugs, la documentation, la gestion des tâches, les tests automatisés et les déploiements continus.</li></ul></section><section><ul><li>Il existe de nombreuses forges logicielles, les plus populaires aujourd&rsquo;hui étant <a href=https://github.com/ target=_blank rel=noopener>GitHub</a>, <a href=https://gitlab.com/ target=_blank rel=noopener>GitLab</a> et <a href=https://bitbucket.org/ target=_blank rel=noopener>Bitbucket</a>.</li><li>Cette formation va s&rsquo;intéresser à GitLab, mais la plupart des fonctionnalités qui seront présentées se retrouvent sous des formes similaires sur les autres plateformes.<ul><li>GitLab a l&rsquo;intérêt d&rsquo;avoir une version open source qui permet de l&rsquo;installer de manière indépendante dans son propre environnement de production.</li></ul></li></ul></section><section><h2 id=dépôt-distant->Dépôt distant ?</h2><ul><li>Un dépôt distant est un dépôt Git hébergé sur un serveur, permettant de centraliser et de redistribuer les modifications d&rsquo;un projet à toute l&rsquo;équipe.</li><li>Les forges logicielles incluent un serveur Git pour l&rsquo;hébergement de dépôts distants.</li></ul></section><section><h2 id=établir-une-connexion-sécurisée-ssh>Établir une connexion sécurisée SSH</h2><ul><li>Git peut utiliser plusieurs protocoles pour dialoguer avec un dépôt distant. Les plus fréquemment utilisés sont HTTPS et SSH.</li><li>GitLab prend en charge ces deux protocoles : HTTPS via l&rsquo;utilisation de jetons d&rsquo;accès et SSH via un système de clés asymétriques.</li></ul></section><section><ul><li>À l&rsquo;usage, SSH est généralement le choix le plus simple et performant pour travailler de manière régulière depuis le même ordinateur.</li><li>Sa configuration demande de générer une paire de clés de chiffrement, et de communiquer la clé publique à GitLab.</li></ul></section><section><h3 id=générer-une-paire-de-clés-ssh>Générer une paire de clés SSH</h3><ul><li>La génération d&rsquo;une paire de clés SSH s&rsquo;effectue à partir du terminal de l&rsquo;ordinateur avec la commande <code>ssh-keygen</code> :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>ssh-keygen -t ed25519
</span></span></code></pre></div><ul><li><code>ed25519</code> est l&rsquo;algorithme de génération des clés, s&rsquo;appuyant sur l&rsquo;algèbre des courbes elliptiques. Il existe également <code>rsa</code> qui repose sur la théorie des nombres premiers.</li></ul></li></ul></section><section><ul><li>Une fois la commande lancée, le terminal pose plusieurs questions :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>Generating public/private ed25519 key pair.
</span></span><span style=display:flex><span>Enter file in which to save the key (C:\Users\&lt;Utilisateur&gt;/.ssh/id_ed25519):
</span></span></code></pre></div><ul><li>Appuyer sur &ldquo;Entrée&rdquo; pour valider le chemin par défaut, ou préciser un chemin</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>Enter passphrase (empty for no passphrase):
</span></span><span style=display:flex><span>Enter same passphrase again:
</span></span></code></pre></div><ul><li>Si l&rsquo;ordinateur n&rsquo;est pas partagé et correctement sécurisé, il est possible de ne pas saisir de mot de passe.</li><li>Sinon, le mot de passe saisi ici devra être entré à chaque utilisation de la clé.</li></ul></li></ul></section><section><ul><li>Une fois les informations saisies, le terminal confirme la réussite de la création de la clé en donnant ses informations d&rsquo;identification :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>Your identification has been saved in C:\Users\&lt;Utilisateur&gt;\.ssh\id_ed25519
</span></span><span style=display:flex><span>Your public key has been saved in C:\Users\&lt;Utilisateur&gt;\.ssh\id_ed25519.pub
</span></span><span style=display:flex><span>The key fingerprint is:
</span></span><span style=display:flex><span>SHA256:nmqJx3Wutsb8fe75FUDLYiQqJk4E6ZeWe1X6FdvDM+w &lt;Utilisateur&gt;@&lt;Hostname&gt;
</span></span><span style=display:flex><span>The key&#39;s randomart image is:
</span></span><span style=display:flex><span>+--[ED25519 256]--+
</span></span><span style=display:flex><span>| .o.     . . .   |
</span></span><span style=display:flex><span>| ..     ..o.o .  |
</span></span><span style=display:flex><span>|.  ooo .o  o*+   |
</span></span><span style=display:flex><span>| .o=o .o  .o.B.  |
</span></span><span style=display:flex><span>|  o.. . S . . +. |
</span></span><span style=display:flex><span>|   . . ..o.  E  .|
</span></span><span style=display:flex><span>|    .o =oo      .|
</span></span><span style=display:flex><span>|    . =.= ..  ...|
</span></span><span style=display:flex><span>|     o.oo+. .++..|
</span></span><span style=display:flex><span>+----[SHA256]-----+
</span></span></code></pre></div></li></ul></section><section><ul><li>La clé publique doit alors être renseignée dans GitLab pour pouvoir l&rsquo;utiliser comme serveur de dépôt distant.<ul><li>Il faut pour cela se connecter à GitLab et accéder à la <a href=https://gitlab.com/-/profile/keys target=_blank rel=noopener>page de configuration des clés SSH de GitLab</a>.
<img src=gitlab/ssh.png alt="Interface d&amp;rsquo;ajout d&amp;rsquo;une clé SSH dans GitLab"></li></ul></li></ul></section><section><ul><li>L&rsquo;empreinte à saisir dans le champ clé peut être obtenue en lisant le fichier de la clé publique dont l&rsquo;emplacement a été donné précédemment :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>cat C:<span style=color:#ae81ff>\U</span>sers<span style=color:#ae81ff>\&lt;</span>Utilisateur&gt;<span style=color:#ae81ff>\.</span>ssh<span style=color:#ae81ff>\i</span>d_ed25519.pub
</span></span></code></pre></div></li><li>Le champ &ldquo;Titre&rdquo; peut être rempli librement avec un nom permettant de reconnaître la clé.</li><li>Le type d&rsquo;utilisation &ldquo;Authentification et Signature&rdquo; permet d&rsquo;également utiliser la clé pour signer de manière sécurisée ses commits.</li><li>La date d&rsquo;expiration est une sécurité facultative pour forcer le renouvellement ponctuel des clés.</li></ul></section><section><h2 id=créer-un-dépôt-distant>Créer un dépôt distant</h2><ul><li>La création d&rsquo;un dépôt distant commence par la <a href=https://gitlab.com/projects/new target=_blank rel=noopener>création d&rsquo;un nouveau projet GitLab</a>.<ul><li>Dans un premier temps, il est conseillé de choisir &ldquo;Create blank project&rdquo; pour démarrer d&rsquo;un dépôt vide.</li></ul></li></ul></section><section><img src=gitlab/blank_project.png alt="Interface de création d'un projet vide sur GitLab"><ul><li>La case &ldquo;Initialiser le dépôt avec un README&rdquo; ne doit PAS être cochée si un dépôt local existe déjà.</li></ul></section><section><h3 id=relier-un-dépôt-local-existant-à-un-dépôt-distant>Relier un dépôt local existant à un dépôt distant</h3><ul><li><code>git remote</code> permet de gérer les dépôts distants. Par convention, le dépôt distant principal d&rsquo;un projet s&rsquo;appelle <code>origin</code>.</li><li>Pour déclarer un nouveau dépôt distant dans un dépôt local existant et lui envoyer tout le contenu actuel, trois commandes sont nécessaires :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git remote add origin git@gitlab.com:&lt;nom-utilisateur&gt;/&lt;slug-projet&gt;.git
</span></span><span style=display:flex><span>git push -u origin --all
</span></span><span style=display:flex><span>git push -u origin --tags
</span></span></code></pre></div></li></ul></section><section><h3 id=cloner-localement-un-dépôt-distant>Cloner localement un dépôt distant</h3><ul><li>Si le projet a d&rsquo;abord été créé comme un dépôt distant, ou pour récupérer le code d&rsquo;un projet déjà existant, Git permet également le cloner un dépôt distant.</li><li>Le développeur récupère alors une copie locale de l&rsquo;intégralité des fichiers et de l&rsquo;historique du projet. La commande à utiliser est <code>git clone</code> :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git clone git@gitlab.com:&lt;nom-utilisateur&gt;/&lt;slug-projet&gt;.git
</span></span></code></pre></div><ul><li>Le dépôt distant est automatiquement configuré comme <code>origin</code>.</li></ul></li></ul></section><section><h2 id=synchroniser-le-dépôt-local-et-le-dépôt-distant>Synchroniser le dépôt local et le dépôt distant</h2><ul><li>Puisque le dépôt local est une copie intégrale du dépôt distant, le développeur peut travailler en mode déconnecté.</li><li>Néanmoins, il est important de pouvoir régulièrement se synchroniser pour récupérer les modifications faites par les autres et envoyer les siennes.</li></ul></section><section><h3 id=envoyer-des-modifications>Envoyer des modifications</h3><ul><li>La commande <code>git push</code> permet d&rsquo;envoyer les modifications (les commits) effectuées localement dans une branche :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git push
</span></span></code></pre></div><ul><li>Git recherchera une branche portant le même nom que la branche locale sur <code>origin</code> et y enverra les modifications locales.</li><li>Si la branche a été créé localement, l&rsquo;option <code>--set-upstream</code> permet de demander à Git de la créer sur le serveur.</li></ul></li></ul></section><section><ul><li>Les opérations sur les tags doivent également être synchronisées avec le serveur grâce à <code>git pull</code> :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git push --tags
</span></span></code></pre></div></li><li>Si des opérations de réécriture de l&rsquo;historique ont été menées (comme un rebase), il faudra demander à Git de forcer cette réécriture sur le dépôt distant :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git push --force-with-lease
</span></span></code></pre></div><ul><li>Cette opération échouera si d&rsquo;autres modifications ont été effectuées entre temps sur la branche, pour éviter tout risque de perte de code.</li></ul></li></ul></section><section><h3 id=récupérer-des-modifications>Récupérer des modifications</h3><ul><li>Récupérer des modifications revient à fusionner la branche distante dans la branche locale. Cette opération s&rsquo;effectue grâce à <code>git pull</code> :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git pull
</span></span></code></pre></div><ul><li>Si on souhaite effectuer cette fusion avec un rebase, il suffit d&rsquo;ajouter l&rsquo;option <code>--rebase</code>.</li><li>Le <code>pull</code> est en fait l&rsquo;enchaînement de deux opérations : <code>fetch</code> pour télécharger les modifications, puis <code>merge</code> pour les intégrer.</li></ul></li></ul></section><section><h2 id=rôles-et-permissions>Rôles et permissions</h2><ul><li>Même lorsqu&rsquo;un dépôt est public et peut être cloné librement, GitLab propose un système de contrôle d&rsquo;accès permettant de donner des droits différenciés aux différents intervenants d&rsquo;un projet.</li><li>Ces paramètres se règlent à l&rsquo;échelle du projet dans les options relatives aux Membres.</li></ul></section><section><ul><li><em>Owner</em> : Le propriétaire du projet est responsable du projet et a tous les droits sur celui-ci.</li><li><em>Maintainer</em> : Les mainteneurs ont les mêmes droits que le propriétaire du projet, à l&rsquo;exception de la suppression du projet ou de certains éléments.</li><li><em>Developer</em> : Les développeurs peuvent créer des branches, effectuer des commits et des merge requests, et commenter les demandes de fusion. Par défaut, ils ne peuvent pas valider des demandes de fusion ou supprimer des branches protégées.</li></ul></section><section><ul><li><em>Reporter</em> : Les rapporteurs peuvent créer et gérer des tickets, mais ne peuvent pas effectuer de modifications sur le code source.</li><li><em>Guest</em> : Les invités ont un accès limité en lecture seule au projet et ne peuvent pas effectuer de modifications sur le code source. Ils peuvent être autorisés à créer des tickets.</li></ul></section><section><h2 id=gestion-des-tickets>Gestion des tickets</h2><ul><li>GitLab propose un système de gestion de tickets pour les évolutions fonctionnelles (<em>Issue</em>) et les bugs (<em>Incidents</em>).</li><li>Les tickets peuvent ensuite être visualisés en liste, ou sur un tableau du type Kanban.</li></ul></section><section><h3 id=créer-un-ticket>Créer un ticket</h3><img src=gitlab/new_ticket.png alt="Interface de création d'un ticket GitLab" height=580></section><section><ul><li>Un ticket peut être relié à un jalon, par exemple une itération pour un projet Scrum.</li><li>Il peut également être associé à une étiquette dont la liste est définie à l&rsquo;échelle du projet. Il existe deux approches courantes et complémentaires :<ul><li>Par type de ticket : amélioration, correction de bug, accessibilité&mldr;</li><li>Par phase de travail : spécification, développement, recette&mldr;</li></ul></li></ul></section><section><h3 id=gérer-un-ticket>Gérer un ticket</h3><img src=gitlab/manage_ticket.png alt="Interface de gestion d'un ticket GitLab" height=580></section><section><ul><li>GitLab permet de décomposer un ticket en sous-tâches, mais aussi de l&rsquo;associer à d&rsquo;autres tickets.</li><li>Il est également possible de créer automatiquement une branche liée au ticket, ce qui permet de le clore une fois la branche fusionnée.</li><li>Des outils de gestion du temps (estimation de charge, date d&rsquo;échéance) sont également proposés.</li></ul></section><section><h2 id=branches-protégées>Branches protégées</h2><ul><li>GitLab inclut un mécanisme de protection des branches d&rsquo;un dépôt.<ul><li>Cette protection permet de contrôler qui peut envoyer ou fusionner du code dans certaines branches, notamment dans <code>main</code>.</li><li>La protection peut obliger à passer par les merge requests pour modifier le code d&rsquo;une branche.</li></ul></li><li>Il est toujours possible de faire des fusions ou des ajouts sur le dépôt local dans les branches protégées, mais les opérations de type <code>git push</code> seront alors systématiquement rejetées.</li></ul></section><section><h3 id=merge-requests>Merge Requests</h3><ul><li>Une merge request est une demande de fusion, c&rsquo;est-à-dire que son auteur demande à ce qu&rsquo;une branche (généralement celle sur laquelle il a travaillé) soit la branche source d&rsquo;un <code>git merge</code> sur une branche cible protégée.<ul><li>Selon la configuration du dépôt, la validation de cette demande peut être soumise à approbation préalable ou à la validation de tests.</li></ul></li></ul></section><section><h4 id=créer-une-merge-request>Créer une merge request</h4><img src=gitlab/merge_request.png alt="Interface de création d'une merge request GitLab" height=580></section><section><ul><li>La création d&rsquo;une merge request demande au développeur de préciser les branches source et cible et de décrire ses modifications.</li><li>Il est possible de configurer une merge request pour qu&rsquo;elle effectue automatiquement un squash lorsqu&rsquo;elle est validée (<em>&ldquo;Écraser les commits lorsque la demande de fusion est validée&rdquo;</em>), ou pour supprimer la branche source.</li></ul></section><section><h4 id=valider-une-merge-request>Valider une merge request</h4><img src=gitlab/merge_request_ready.png alt="Interface de validation d'une merge request GitLab" height=580></section><section><ul><li>Lorsque le message <em>&ldquo;Ready to merge !&rdquo;</em> est visible sur une merge request, elle est prête à être validée et fusionnée.<ul><li>L&rsquo;option <em>&ldquo;Delete source branch&rdquo;</em> permet de supprimer automatiquement la branche source une fois l&rsquo;opération terminée</li><li><em>Edit commit message</em> permet de modifier le message du commit de merge, pour la lisibilité de l&rsquo;historique.</li></ul></li><li>Une fois la validation effectuée, l&rsquo;exécution de la commande <code>git pull</code> permet de répercuter la fusion sur le dépôt local.</li></ul></section></section><section><section data-shortcode-section><h1 id=flux-de-travail-usuels>Flux de travail usuels</h1><p>GitFlow, OneFlow, GitLab Flow</p></section><section><h2 id=flux-de-travail->Flux de travail ?</h2><ul><li>Un flux de travail (en anglais, <em>workflow</em>) est une façon standardisée d&rsquo;organiser les branches d&rsquo;un projet Git.</li><li>Leur utilisation permet de bénéficier de méthodes éprouvées pour s&rsquo;adapter à des modes usuels d&rsquo;organisation et d&rsquo;outils spécifiquement conçus pour leur prise en charge.</li></ul></section><section><h2 id=gitflow>GitFlow</h2><ul><li>GitFlow est un flux de travail qui a été proposé par <a href=https://nvie.com/posts/a-successful-git-branching-model/ target=_blank rel=noopener>Vincent Driessen</a> en 2010.</li><li>Son objectif est de permettre en parallèle la maintenance d&rsquo;une version de production et l&rsquo;élaboration d&rsquo;une version de développement.</li></ul></section><section><ul><li>GitFlow s&rsquo;appuie sur 5 familles de branches :<ul><li><code>main</code> : branche principale et permanente, chaque version de main est vouée à être mise en production</li><li><code>develop</code> : branche permanente, soutenant la version de développement</li><li><code>feature</code> : branches éphémères tirées de <code>develop</code>, dédiées au développement d&rsquo;une fonctionnalité</li><li><code>release</code> : branches éphémères tirées de <code>develop</code>, servant aux ultimes correctifs avant mise en production</li><li><code>hotfix</code> : branches éphémères tirées de <code>main</code>, permettant la correction de bugs en production</li></ul></li></ul></section><section><h3 id=exemple-avec-gitflow>Exemple avec GitFlow</h3><div class=mermaid><pre>
    %%{init: {'theme': 'dark', 'themeVariables': { 'darkMode': true }}}%%
    gitGraph
        commit tag: "v1.0.0"
        branch develop order: 3
        branch feature/US1 order: 4
        commit
        commit
        checkout main
        branch hotfix/1.0.1 order: 1
        commit
        checkout main
        merge hotfix/1.0.1 tag: "v1.0.1"
        checkout develop
        merge hotfix/1.0.1
        branch feature/US2 order: 5
        commit
        commit
        checkout feature/US1
        commit
        checkout develop
        merge feature/US1
        branch release/1.1.0 order: 2
        commit
        commit
        checkout main
        merge release/1.1.0 tag: "v1.1.0"
        checkout develop
        merge release/1.1.0
        checkout feature/US2
        commit
  </pre></div></section><section><h3 id=utilisation-de-lextension-gitflow>Utilisation de l&rsquo;extension GitFlow</h3><ul><li>Les installations de Git pour Windows depuis la version 2.6.4 incluent directement une extension permettant une prise en charge simplifiée de GitFlow.<ul><li>Pour macOS et Linux, un paquet nommé <code>git-flow</code> est généralement disponible pour installer cette extension.</li></ul></li><li>L&rsquo;extension se manipule ensuite en ligne de commandes au travers de l&rsquo;instruction <code>git flow</code></li></ul></section><section><h4 id=initialisation>Initialisation</h4><ul><li>L&rsquo;initialisation de GitFlow s&rsquo;effectue en utilisant la sous-commande <code>init</code> de <code>git flow</code> :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git flow init
</span></span></code></pre></div></li><li>Git demande alors des informations sur les noms à utiliser pour les différentes branches et les tags de version :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>Which branch should be used for bringing forth production releases?
</span></span><span style=display:flex><span>Branch name for production releases: [main]
</span></span><span style=display:flex><span>Branch name for &#34;next release&#34; development: [develop]
</span></span><span style=display:flex><span>How to name your supporting branch prefixes?
</span></span><span style=display:flex><span>Feature branches? [feature/]
</span></span><span style=display:flex><span>Release branches? [release/]
</span></span><span style=display:flex><span>Hotfix branches? [hotfix/]
</span></span><span style=display:flex><span>Version tag prefix? [] v
</span></span></code></pre></div></li></ul></section><section><h4 id=développer-une-fonctionnalité>Développer une fonctionnalité</h4><ul><li>Pour démarrer une branche de fonctionnalité, il suffit d&rsquo;utiliser l&rsquo;instruction <code>feature start</code> :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git flow feature start &lt;nom_de_la_fonction&gt;
</span></span></code></pre></div><ul><li>Git va alors automatiquement créer une branche à partir de <code>develop</code> et l&rsquo;activer.</li></ul></li><li>Il est ensuite possible de publier cette branche sur un dépôt distant :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git flow feature publish &lt;nom_de_la_fonction&gt;
</span></span></code></pre></div></li></ul></section><section><ul><li>Il est également possible de récupérer une branche de fonctionnalité à partir d&rsquo;un dépôt distant :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git flow feature pull origin &lt;nom_de_la_fonction&gt;
</span></span></code></pre></div></li><li>Enfin, une fois le développement d&rsquo;une fonctionnalité terminée, il est possible de la clôturer :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git flow feature finish &lt;nom_de_la_fonction&gt;
</span></span></code></pre></div><ul><li>Cette commande fusionne la branche de fonctionnalité dans <code>develop</code>, supprime la branche devenue inutile et réactive <code>develop</code>.</li></ul></li></ul></section><section><h4 id=réaliser-une-version-de-production-ou-un-correctif>Réaliser une version de production ou un correctif</h4><ul><li>Les mêmes commandes que pour les fonctionnalités peuvent s&rsquo;utiliser pour les versions de production ou les correctifs, en remplaçant le mot-clé <code>feature</code> par <code>release</code> ou <code>hotfix</code> :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>git flow release start &lt;numero_de_version&gt; &lt;commit_de_depart&gt;
</span></span></code></pre></div><ul><li>Le numéro de version saisi sera ensuite apposé comme un tag lors de la fusion dans <code>main</code>.</li><li>Il est possible de faire partir une <code>release</code> (resp., <code>hotfix</code>) de n&rsquo;importe quel commit de <code>develop</code> (resp., <code>main</code>).</li></ul></li></ul></section><section><h2 id=oneflow>OneFlow</h2><ul><li>OneFlow est une évolution de GitFlow proposée par <a href=https://www.endoflineblog.com/oneflow-a-git-branching-model-and-workflow target=_blank rel=noopener>Adam Ruka</a> en 2017.</li><li>Son objectif est de proposer un historique plus clair et lisible sur le long terme en ne se basant que sur une branche perpétuelle.</li><li>Utiliser OneFlow de manière efficace implique de manipuler les tags et les <code>squash</code> ou les <code>rebase</code>.</li></ul></section><section><ul><li>OneFlow s&rsquo;appuie sur une branche principale : <code>main</code> qui sert de branche de développement</li><li>On dérive de cette branche trois types de branches éphémères :<ul><li><code>feature</code> pour les fonctionnalités</li><li><code>release</code> pour les mises en production</li><li><code>hotfix</code> pour les correctifs sur la production</li></ul></li><li>Les branches <code>release</code> et <code>hotfix</code> s&rsquo;achèvent par un tag qui permet d&rsquo;identifier leur dernier commit comme étant prêt à être mis en production.</li></ul></section><section><h3 id=exemple-avec-oneflow>Exemple avec OneFlow</h3><div class=mermaid><pre>
    %%{init: {'theme': 'dark', 'themeVariables': { 'darkMode': true }}}%%
    gitGraph
        commit tag: "v1.0.0"
        branch hotfix/1.0.1 order: 1
        branch feature/US1 order: 3
        commit
        commit
        checkout main
        checkout hotfix/1.0.1
        commit
        checkout main
        merge hotfix/1.0.1 tag: "v1.0.1"
        branch feature/US2 order: 4
        commit
        commit
        checkout feature/US1
        commit
        checkout main
        merge feature/US1
        branch release/1.1.0 order: 2
        commit
        commit
        checkout main
        merge release/1.1.0 tag: "v1.1.0"
        checkout feature/US2
        commit
  </pre></div></section><section><ul><li>Pour améliorer encore la lisibilité de l&rsquo;historique, il est conseillé de rebase les branches de fonctionnalité sur la dernière version étiquetée de <code>main</code> avant de les fusionner :</li></ul><div class=mermaid><pre>
    %%{init: {'theme': 'dark', 'themeVariables': { 'darkMode': true }}}%%
    gitGraph
        commit tag: "v1.0.0"
        branch hotfix/1.0.1 order: 1
        checkout main
        checkout hotfix/1.0.1
        commit
        checkout main
        merge hotfix/1.0.1 tag: "v1.0.1"
        branch feature/US1 order: 3
        commit
        commit
        commit
        checkout main
        merge feature/US1
        branch release/1.1.0 order: 2
        commit
        commit
        checkout main
        merge release/1.1.0 tag: "v1.1.0"
        branch feature/US2 order: 4
        commit
        commit
        commit
        checkout main
        merge feature/US2
  </pre></div></section><section><h2 id=gitlab-flow>GitLab Flow</h2><ul><li>GitLab Flow est une autre approche alternative à GitFlow qui a été proposé par les équipes de développement de <a href=https://about.gitlab.com/topics/version-control/what-is-gitlab-flow/ target=_blank rel=noopener>GitLab</a> en 2016.</li><li>Son approche combine celle des branches de fonctionnalité avec une prise en charge de multiples environnements de déploiement.<ul><li>Elle est donc plus particulière adaptée aux grandes organisations qui ont un système informatique complexe.</li></ul></li></ul></section><section><ul><li>Dans GitLab Flow, <code>main</code> est une branche perpétuelle qui sert au développement.<ul><li>On en découle des branches de fonctionnalités éphémères.</li></ul></li><li>Il existe également autant de branches permanentes que d&rsquo;environnements de déploiement.<ul><li>Les fonctionnalités et les correctifs se déplacent entre les branches par fusion.</li></ul></li></ul></section><section><h3 id=exemple-avec-gitlab-flow>Exemple avec GitLab Flow</h3><div class=mermaid><pre>
    %%{init: {'theme': 'dark', 'themeVariables': { 'darkMode': true }}}%%
    gitGraph
        commit
        branch qualification order: 3
        commit
        checkout main
        branch production order: 5
        commit tag: "v1.0.0"
        checkout main
        branch feature/US1 order: 1
        commit
        commit
        checkout production
        branch hotfix/1.0.1 order: 4
        checkout hotfix/1.0.1
        commit
        commit
        commit
        checkout production
        merge hotfix/1.0.1 tag: "v1.0.1"
        checkout qualification
        merge hotfix/1.0.1
        checkout main
        merge qualification
        branch feature/US2 order: 2
        commit
        commit
        checkout feature/US1
        commit
        checkout main
        merge feature/US1
        checkout qualification
        merge main
        checkout production
        merge qualification tag: "v1.1.0"
        checkout feature/US2
        commit
        checkout main
        merge feature/US2
        checkout qualification
        merge main
  </pre></div></section><section><ul><li>Le GitLab Flow permet de maintenir plusieurs versions de recette et de production en parallèle, et de maîtriser les fonctionnalités proposées.<ul><li>Mais, il demande de faire preuve de vigilance dans les opérations de fusion pour s&rsquo;assurer qu&rsquo;un correctif fait à un endroit a bien été répercuté partout où il devait l&rsquo;être.</li><li>La lisibilité de l&rsquo;historique peut également être améliorée en utilisant des <code>rebase</code>.</li></ul></li></ul></section><section><h2 id=remarques>Remarques</h2><ul><li>Il existe bien d&rsquo;autres flux de travail pour Git et aucun n&rsquo;a vocation à être une solution universelle qui s&rsquo;adapte à tous les environnements.</li><li>Il est même tout à fait possible de concevoir un flux &ldquo;sur mesure&rdquo; pour répondre à un besoin spécifique.</li><li>Le plus important est surtout que toute l&rsquo;équipe qui travaille sur un projet ait connaissance du flux en vigueur et l&rsquo;applique.</li></ul></section></section><section><section data-shortcode-section><h1 id=git-et-lintégration-continue-ci>Git et l&rsquo;intégration continue (CI)</h1><p>Introduction aux pipelines GitLab CI/CD</p></section><section><h2 id=intégration-continue->Intégration continue ?</h2><ul><li>L&rsquo;intégration continue (<em>Continuous Integration, CI</em>) est une pratique de développement logiciel qui consiste à tester et à construire automatiquement un projet chaque fois qu&rsquo;un développeur soumet un changement dans le code source.</li><li>Cette pratique vise à détecter rapidement les erreurs de code et à garantir que le code est fonctionnel et prêt à être déployé.</li></ul></section><section><h2 id=pipeline->Pipeline ?</h2><ul><li>Un pipeline d&rsquo;intégration continue est un processus automatisé qui permet de construire, tester et déployer un projet.</li><li>Il s&rsquo;agit d&rsquo;une série d&rsquo;étapes configurées pour être exécutées automatiquement par un <code>runner</code> lorsque des événements surviennent un dépôt (comme un commit).</li></ul></section><section><h2 id=gitlab-cicd->GitLab CI/CD ?</h2><ul><li>GitLab CI/CD est l&rsquo;outil permettant de configurer des pipelines d&rsquo;intégration continue dans un projet géré sur GitLab.<ul><li>Il s&rsquo;appuie sur les runners <a href=https://docs.gitlab.com/runner/ target=_blank rel=noopener>GitLab Runner</a> qui sont une technologie open source pouvant être déployée sur sa propre installation.</li></ul></li></ul></section><section><h2 id=configurer-un-pipeline-gitlab-cicd>Configurer un pipeline GitLab CI/CD</h2><ul><li>La configuration d&rsquo;un pipeline GitLab CI/CD repose sur la rédaction d&rsquo;un fichier de configuration nommé &ldquo;manifeste&rdquo;.</li><li>Par convention, le manifeste se nomme <code>.gitlab-ci.yml</code> et doit être placé à la racine du dépôt.</li><li>Le manifeste est écrit en <a href=https://www.redhat.com/fr/topics/automation/what-is-yaml target=_blank rel=noopener>YAML</a>, un langage de sérialisation de données généralement utilisé pour écrire des fichiers de configuration.</li></ul></section><section><h3 id=exemple-de-syntaxe-yaml>Exemple de syntaxe YAML</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#75715e># Commentaire</span>
</span></span><span style=display:flex><span><span style=color:#f92672>cle</span>: <span style=color:#ae81ff>valeur</span>
</span></span><span style=display:flex><span><span style=color:#f92672>parent</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>enfant</span>: <span style=color:#ae81ff>valeur</span>
</span></span><span style=display:flex><span><span style=color:#f92672>liste</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>option 1</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>option 2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>niveau1</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>niveau2</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>niveau3a</span>: <span style=color:#ae81ff>valeur a</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>niveau3b</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      1 choix 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      2 choix 2</span>      
</span></span><span style=display:flex><span>    <span style=color:#f92672>niveau3c</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>liste</span>
</span></span></code></pre></div></section><section><h3 id=jobs>Jobs</h3><ul><li>Un pipeline GitLab CI/CD est composé de <code>jobs</code>, qui sont un ensemble d&rsquo;instructions de ligne de commande (un script) qui doivent être exécutées par le runner :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#f92672>job:nom-du-job</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>script</span>: 
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>commande 1</span>
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>commande 2</span>
</span></span></code></pre></div></li><li>Par défaut, tous les jobs définis dans le manifeste s&rsquo;exécutent simultanément.</li></ul></section><section><h3 id=images>Images</h3><ul><li>Les runners GitLab reposent sur une technologie de conteneurisation compatible avec Docker.</li><li>Il est donc possible de demander à un job de s&rsquo;exécuter à partir d&rsquo;une image Docker, pour éviter d&rsquo;avoir à configurer à la main un environnement :<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#f92672>job:build</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>image</span>: <span style=color:#ae81ff>maven/3-eclipse-temurin-17</span> <span style=color:#75715e># Maven 3 + Java 17</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>script</span>: 
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>mvn package</span>
</span></span></code></pre></div></li></ul></section><section><h3 id=étapes>Étapes</h3><ul><li>Il est possible de regrouper des jobs par étapes, nommées <code>stages</code> qui s&rsquo;exécuteront de manière séquencée.<ul><li>Tous les jobs d&rsquo;une même étape s&rsquo;exécutent simultanément, puis GitLab passe aux jobs de l&rsquo;étape suivante.</li></ul></li><li>Le manifeste doit donc contenir une déclaration des étapes du pipeline, puis chaque job doit être rattaché à une étape.</li></ul></section><section><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#f92672>stages</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>build</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>test</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>job:build</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>image</span>: <span style=color:#ae81ff>maven/3-eclipse-temurin-17</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>stage</span>: <span style=color:#ae81ff>build</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>script</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>mvn package</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#f92672>job:unit-test</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>image</span>: <span style=color:#ae81ff>maven/3-eclipse-temurin-17</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>stage</span>: <span style=color:#ae81ff>test</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>script</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>mvn test</span>
</span></span></code></pre></div></section><section><h3 id=règles-de-lancement-conditionnel>Règles de lancement conditionnel</h3><ul><li>Par défaut, GitLab CI/CD exécute le pipeline à chaque fois qu&rsquo;un commit est envoyé.</li><li>Il est possible de fixer des conditions pour modifier ce comportement, par exemple pour n&rsquo;exécuter certaines étapes que dans certaines branches.</li><li>Le mot-clé <code>rules</code> permet de fixer ces règles de lancement conditionnel pour un job.</li></ul></section><section><ul><li>Au sein du bloc <code>rules</code>, il est possible de fixer une ou plusieurs conditions avec <code>if</code>.<ul><li>Il faut et il suffit qu&rsquo;une des conditions soit respectée pour qu&rsquo;un job puisse être exécuté.</li></ul></li><li>Plusieurs variables usuelles sont disponibles pour rédiger ces conditions :<ul><li><code>$CI_COMMIT_BRANCH</code> : branche du commit</li><li><code>$CI_COMMIT_TAG</code> : tags du commit</li><li><code>$CI_COMMIT_TITLE</code> : message du commit</li></ul></li></ul></section><section><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#f92672>job:deploy</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>image</span>: <span style=color:#ae81ff>maven/3-eclipse-temurin-17</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>script</span>: 
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>mvn deploy</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>rules</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>if</span>: <span style=color:#ae81ff>$CI_COMMIT_BRANCH == &#34;main&#34;</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>if</span>: <span style=color:#ae81ff>$CI_COMMIT_TITLE =~ /Deploy.*/</span>
</span></span></code></pre></div><ul><li>Dans cet exemple, le job <code>deploy</code> ne s&rsquo;exécutera que si le pipeline est déclenché depuis la branche <code>main</code> ou si le message de commit débute par &ldquo;Deploy&rdquo;.</li></ul></section><section><h3 id=modes-dexécution>Modes d&rsquo;exécution</h3><ul><li>Les modes d&rsquo;exécution sont une autre façon de conditionner le lancement d&rsquo;un job.</li><li>Par défaut, les jobs d&rsquo;une étape ne se lancent que si tous les jobs de l&rsquo;étape précédente se sont terminés avec succès.</li><li>L&rsquo;option <code>when</code> permet de modifier ce comportement.<ul><li><code>when</code> peut être combiné avec <code>rules</code> pour créer des scénarios d&rsquo;exécution complexes.</li></ul></li></ul></section><section><ul><li>Plusieurs modes d&rsquo;exécution sont disponibles :<ul><li><code>on_success</code> : seulement si tous les jobs de l&rsquo;étape précédente réussissent (mode par défaut)</li><li><code>on_failure</code> : seulement si au moins un job de l&rsquo;étape précédente a échoué</li><li><code>always</code> : toujours exécuter ce job</li><li><code>never</code> : ne jamais exécuter ce job (utile en combinaison avec <code>rules</code>)</li><li><code>manual</code> : ne pas exécuter automatiquement ce job, mais permettre de le lancer manuellement</li></ul></li><li>Il est également possible de rendre l&rsquo;échec d&rsquo;un job non bloquant avec <code>allow-failure: true</code></li></ul></section><section><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#f92672>job:deploy</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>image</span>: <span style=color:#ae81ff>maven/3-eclipse-temurin-17</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>script</span>: 
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>mvn deploy</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>rules</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>if</span>: <span style=color:#ae81ff>$CI_COMMIT_BRANCH == &#34;main&#34;</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>if</span>: <span style=color:#ae81ff>$CI_COMMIT_TITLE =~ /Deploy.*/</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>when</span>: <span style=color:#ae81ff>manual</span>
</span></span></code></pre></div><ul><li>Désormais, le job <code>deploy</code> ne se lancera plus automatiquement si le commit commence par &ldquo;Deploy&rdquo;, mais une option permettant de le lancer manuellement sera proposée à la place.</li></ul></section><section><h3 id=cache>Cache</h3><ul><li>Le cache permet de sauvegarder des fichiers/dossiers d&rsquo;un runner et de les partager tout au long du pipeline.<ul><li>Il est détruit une fois le pipeline terminé.</li></ul></li><li>L&rsquo;utilisation du cache permet par exemple d&rsquo;éviter de rebuild plusieurs fois un même projet entre les différentes étapes du pipeline.</li></ul></section><section><ul><li>Un bloc <code>cache</code> doit préciser les fichiers et dossiers concernés dans le sous-bloc <code>paths</code>.</li><li>Par défaut, le job commencera par récupérer les fichiers du cache au début de son exécution, et écrira les modifications à la fin.<ul><li>Ce comportement peut être modifié avec l&rsquo;option <code>policy</code> :<ul><li><code>pull</code> : récupérer le cache, mais ne pas écrire les modifications</li><li><code>push</code> : ne pas récupérer le cache, mais écrire les modifications</li></ul></li></ul></li></ul></section><section><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#f92672>stages</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>build</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>verify</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>job:build</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>image</span>: <span style=color:#ae81ff>maven/3-eclipse-temurin-17</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>stage</span>: <span style=color:#ae81ff>build</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>script</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>mvn package</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>cache</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>paths</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>target</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>policy</span>: <span style=color:#ae81ff>push</span>
</span></span></code></pre></div><ul><li>À l&rsquo;issue de l&rsquo;exécution de l&rsquo;étape build, le dossier <code>target</code> sera mis en cache pour être réutilisé à l&rsquo;étape <code>verify</code>.</li></ul></section><section><h3 id=artefacts>Artefacts</h3><ul><li>Les artefacts ont un fonctionnement proche du cache, à ceci près qu&rsquo;ils sont préservés à l&rsquo;issue du pipeline.</li><li>Ils peuvent donc être réutilisés dans un autre pipeline, publiés ou bien encore téléchargés.</li><li>Les artefacts se configurent grâce à un bloc <code>artifacts</code>.</li></ul></section><section><ul><li>Le bloc <code>artifacts</code> se décompose en plusieurs sous-blocs :<ul><li><code>paths</code> permet de définir les fichiers et dossiers du runner à rendre disponibles</li><li><code>name</code> définit le nom de l&rsquo;archive zip qui contiendra l&rsquo;artefact</li><li><code>expire_in</code> fixe la durée de vie de l&rsquo;artefact. Par défaut, cette durée s&rsquo;exprime en secondes, mais il est possible de préciser une autre unité.</li></ul></li></ul></section><section><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#f92672>stages</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>build</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>verify</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>job:build</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>image</span>: <span style=color:#ae81ff>maven/3-eclipse-temurin-17</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>stage</span>: <span style=color:#ae81ff>build</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>script</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>mvn package</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>artifacts</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>paths</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>target</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>build</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>expire_in</span>: <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>week</span>
</span></span></code></pre></div><ul><li>Ce job rendra le dossier <code>target</code> disponible au téléchargement dans un fichier nommé <code>build.zip</code>. Ce fichier sera conservé par GitLab pendant 1 semaine.</li></ul></section><section><h2 id=superviser-un-pipeline-gitlab>Superviser un pipeline GitLab</h2><ul><li>Dès qu&rsquo;un pipeline est configuré sur un dépôt GitLab, une icône apparaît en regard de chaque commit.<ul><li>Cette icône indique le résultat du pipeline :<ul><li>Une coche verte indique un pipeline réussi</li><li>Un point d&rsquo;exclamation jaune indique une réussite avec des avertissements</li><li>Une croix rouge signale un pipeline en échec</li><li>Un rond bleu signifie que le pipeline est en cours d&rsquo;exécution</li><li>Une flèche grise invite à exécuter une étape en mode manuel</li></ul></li></ul></li></ul></section><section><h3 id=détails-dun-pipeline>Détails d&rsquo;un pipeline</h3><img src=gitlab/pipeline.png alt="Détail d'un pipeline GitLab"><ul><li>En cliquant sur l&rsquo;icône, on peut accéder à l&rsquo;interface détaillée du pipeline :<ul><li>Chaque colonne correspond à une étape</li><li>Chaque pastille correspond à un job, avec son résultat d&rsquo;exécution</li></ul></li></ul></section><section><h3 id=détails-dun-job>Détails d&rsquo;un job</h3><img src=gitlab/job.png alt="Détail d'un job GitLab"><ul><li>GitLab permet d&rsquo;accéder aux détails d&rsquo;exécution d&rsquo;un job, et notamment aux logs du runner.<ul><li>Cette interface permet également de télécharger les artefacts.</li></ul></li></ul></section></section></div></div><script type=text/javascript src=/reveal-hugo/object-assign.js></script>
<script src=/reveal-js/dist/reveal.js></script>
<script type=text/javascript src=/reveal-js/plugin/markdown/markdown.js></script>
<script type=text/javascript src=/reveal-js/plugin/highlight/highlight.js></script>
<script type=text/javascript src=/reveal-js/plugin/zoom/zoom.js></script>
<script type=text/javascript src=/reveal-js/plugin/notes/notes.js></script>
<script type=text/javascript src=/plugin/mermaid/mermaid.js></script>
<script type=text/javascript>function camelize(e){return e&&Object.keys(e).forEach(function(t){newK=t.replace(/(_\w)/g,function(e){return e[1].toUpperCase()}),newK!=t&&(e[newK]=e[t],delete e[t])}),e}var revealHugoDefaults={center:!0,controls:!0,history:!0,progress:!0,transition:"slide"},revealHugoSiteParams={},revealHugoPageParams={slide_number:"c/t",theme:"moon"},revealHugoPlugins={plugins:[RevealMarkdown,RevealHighlight,RevealZoom,RevealNotes,RevealMermaid]},options=Object.assign({},camelize(revealHugoDefaults),camelize(revealHugoSiteParams),camelize(revealHugoPageParams),camelize(revealHugoPlugins));Reveal.initialize(options)</script></body></html>